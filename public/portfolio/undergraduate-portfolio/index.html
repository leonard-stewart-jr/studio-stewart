<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- InDesign export assets -->
    <link href="publication-web-resources/css/main.css" rel="stylesheet" type="text/css"></link>
    <script src="publication-web-resources/script/main.js" type="text/javascript"></script>

    <!-- Inject the responsive fit script into each iframe page on load -->
    <script>
      (function () {
        function injectFit(iframe) {
          try {
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            if (!doc || !doc.head) return;

            // Prevent duplicate injection
            if (doc.getElementById("__fit_stage_script")) {
              if (typeof doc.defaultView.__id_fit_stage === "function") {
                doc.defaultView.__id_fit_stage();
              }
              return;
            }

            // Build an absolute URL relative to the iframe's current page
            const fitSrc = new URL("../script/fit-stage.js", doc.baseURI).href;

            const s = doc.createElement("script");
            s.id = "__fit_stage_script";
            s.src = fitSrc;
            s.onload = function () {
              if (typeof doc.defaultView.__id_fit_stage === "function") {
                doc.defaultView.__id_fit_stage();
              }
            };
            doc.head.appendChild(s);
          } catch (e) {
            console.warn("fit-stage injection failed:", e);
          }
        }

        function init() {
          var iframe = document.getElementById("contentIFrame");
          if (!iframe) return;
          // Re-inject and fit on every page load
          iframe.addEventListener("load", function () {
            setTimeout(function () { injectFit(iframe); }, 50);
          });
          // Initial attempt (in case content is already loaded)
          setTimeout(function () { injectFit(iframe); }, 100);
        }

        if (document.readyState === "complete" || document.readyState === "interactive") {
          init();
        } else {
          window.addEventListener("DOMContentLoaded", init, { once: true });
        }
      })();
    </script>
  </head>
  <body onload="showHideArrows()">
    <iframe onload="showHideArrows()" id="contentIFrame" class="contentIframeClass" src="publication-web-resources/html/publication.html"></iframe>
    <iframe id="dummyIFrame" class="dummyFrameClass"></iframe>
    <div class="prev" onclick="showPreviousPage()">&#10094;</div>
    <div class="next" onclick="showNextPage()">&#10095;</div>
  </body>
</html>